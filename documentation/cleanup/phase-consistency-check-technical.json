{
  "phase": "consistency-check",
  "timestamp": "2025-11-05T17:58:00Z",
  "mode": "lecture_seule",
  "summary": "Contrôle de cohérence des tsconfig, packages, alias @shared/@ufm/shared, et des fichiers d'environnement.",
  "inputs": {
    "tsconfig": {
      "frontend": "frontend/tsconfig.json",
      "shared": "shared/tsconfig.json",
      "backend": "(absent, projet JS)"
    },
    "packages": {
      "root": "package.json",
      "frontend": "frontend/package.json",
      "backend": "backend/package.json"
    },
    "env": {
      "frontend_dev": "frontend/src/environments/environment.ts",
      "frontend_prod": "frontend/src/environments/environment.prod.ts",
      "backend_env": "backend/.env (local, ignoré)"
    }
  },
  "findings": [
    {
      "id": "TSCFG-FE-ALIAS-SHARED",
      "title": "Alias @shared encore présent dans frontend/tsconfig.json",
      "severity": "low",
      "details": {
        "file": "frontend/tsconfig.json",
        "paths": {"@shared/*": "../../shared/*"},
        "note": "Le monorepo est passé à @ufm/shared (workspace). L'alias peut être retiré après migration complète."
      },
      "recommendation": "Retirer l'alias @shared/* ou le faire pointer vers node_modules/@ufm/shared si vous souhaitez conserver un alias."
    },
    {
      "id": "CODE-FE-LEFTOVER-SHARED-IMPORT",
      "title": "Import résiduel de @shared dans le code frontend",
      "severity": "medium",
      "details": {
        "file": "frontend/src/app/core/models/tag.model.ts",
        "line": 1,
        "snippet": "import { TAG_CATEGORIES } from \"@shared/constants/tag-categories\";"
      },
      "recommendation": "Remplacer par @ufm/shared/constants/tag-categories pour alignement avec le package workspace."
    },
    {
      "id": "PKG-WORKSPACES-OK",
      "title": "Workspaces npm configurés et dépendances @ufm/shared présentes",
      "severity": "info",
      "details": {
        "root_workspaces": ["frontend","backend","shared"],
        "frontend_dep": "@ufm/shared: workspace:*",
        "backend_dep": "@ufm/shared: workspace:*"
      },
      "recommendation": "Exécuter npm i à la racine puis npm run -w shared build pour générer les d.ts/js."
    },
    {
      "id": "ENV-FE-REDACTED",
      "title": "environment.ts/.prod.ts redacted (OK)",
      "severity": "info",
      "details": {
        "frontend_dev": "supabaseUrl=<REDACTED>, supabaseKey=<REDACTED>",
        "frontend_prod": "supabaseUrl=<REDACTED>, supabaseKey=<REDACTED>"
      },
      "recommendation": "Fournir SUPABASE_* via Vercel; ne pas réintroduire de valeurs en clair."
    },
    {
      "id": "ENV-BE-LOCAL-SECRETS",
      "title": "backend/.env contient des secrets (local, ignoré par Git)",
      "severity": "info",
      "details": {
        "file": "backend/.env",
        "secrets_present": ["CLOUDINARY_*","JWT_SECRET","JWT_REFRESH_SECRET","DATABASE_URL"],
        "gitignore": "backend/.env ignoré"
      },
      "recommendation": "OK en local (non committé). En prod, utiliser les secrets Render."
    },
    {
      "id": "TSCFG-SHARED-OK",
      "title": "tsconfig du package shared cohérent",
      "severity": "info",
      "details": {
        "outDir": "./constants",
        "rootDir": "./constants",
        "declaration": true
      },
      "recommendation": "S'assurer d'exécuter 'npm run -w shared build' avant les builds front/back."
    }
  ],
  "verification_commands": [
    "Select-String -Path .\\frontend\\src\\**\\*.ts -Pattern '@shared/' -List",
    "Select-String -Path .\\frontend\\tsconfig.json -Pattern '"@shared/*"' -List",
    "Select-String -Path .\\frontend\\src\\environments\\environment*.ts -Pattern 'supabase' -List",
    "Select-String -Path .\\backend\\package.json -Pattern '@ufm/shared'",
    "Select-String -Path .\\frontend\\package.json -Pattern '@ufm/shared'"
  ],
  "next_steps": [
    "Remplacer l'import résiduel @shared dans frontend/src/app/core/models/tag.model.ts",
    "Optionnel: retirer l'alias @shared/* de frontend/tsconfig.json",
    "Exécuter npm i && npm run -w shared build pour garantir la résolution de @ufm/shared"
  ]
}