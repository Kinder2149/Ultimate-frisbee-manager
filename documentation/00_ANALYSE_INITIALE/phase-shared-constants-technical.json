{
  "phase": "shared-constants",
  "timestamp": "2025-11-05T13:35:00Z",
  "inputs_provided": [
    "shared/ (tree)",
    "shared/constants/tag-categories.ts|.js|.d.ts",
    "shared/tsconfig.json",
    "grep repo '@shared/' usages"
  ],
  "summary": "Dossier shared/ expose des constantes de tags (TS + JS + d.ts). Plusieurs consommateurs frontend via alias @shared. Proposition: packager en workspace @ufm/shared pour supprimer les liens file:.. et assurer versioning.",
  "details": [
    { "path": "shared/constants/tag-categories.ts", "type": "file", "role": "code", "size_bytes": 0, "notes": "Exports: TAG_CATEGORIES (readonly string[]), type TagCategory, TAG_CATEGORY_LABELS (Record<TagCategory,string>), DEFAULT_TAG_COLORS (Partial<Record<TagCategory,string>>), NIVEAU_LABELS (Record<number,string>), isValidCategory(category): category is TagCategory, isValidLevel(level, category): boolean." },
    { "path": "shared/constants/tag-categories.d.ts", "type": "file", "role": "types", "size_bytes": 0, "notes": "Déclarations d'exports (types/const)." },
    { "path": "shared/constants/tag-categories.js", "type": "file", "role": "build_output", "size_bytes": 0, "notes": "JS compilé CommonJS." },
    { "path": "shared/tsconfig.json", "type": "file", "role": "config", "size_bytes": 0, "notes": "outDir=root ./constants (écrase sources), rootDir=./constants, declaration:true, module=commonjs." },

    { "path": "frontend/src/app/core/models/tag.model.ts", "type": "file", "role": "consumer", "size_bytes": 0, "notes": "import { TAG_CATEGORIES } from '@shared/constants/tag-categories'" },
    { "path": "frontend/src/app/features/tags/pages/tags-manager.component.ts", "type": "file", "role": "consumer", "size_bytes": 0, "notes": "@shared/constants/tag-categories" },
    { "path": "frontend/src/app/features/tags/components/tag-form/tag-form.component.ts", "type": "file", "role": "consumer", "size_bytes": 0, "notes": "@shared/constants/tag-categories" },
    { "path": "frontend/src/app/features/tags-advanced/components/tag-mapping/tag-mapping.component.ts", "type": "file", "role": "consumer", "size_bytes": 0, "notes": "@shared/constants/tag-categories" },
    { "path": "frontend/src/app/features/settings/components/tag-list/tag-list.component.ts", "type": "file", "role": "consumer", "size_bytes": 0, "notes": "@shared/constants/tag-categories" }
  ],
  "findings": [
    { "id": "WS-001", "title": "Absence de packaging dédié pour shared/", "severity": "medium", "description": "shared/ n'est pas un package versionné; le backend utilise une dépendance locale file:.. risquée.", "evidence": ["backend/package.json: 'ultimate-frisbee-manager': 'file:..' (besoin lié au partage?)", "tsconfig paths frontend -> '../../shared/*'"], "recommendation": "Créer un package @ufm/shared et basculer vers des workspaces pour un partage propre et versionné." },
    { "id": "WS-002", "title": "Config TS de shared non standard (outDir=root ./constants)", "severity": "low", "description": "outDir=./constants peut écraser sources si build; préférer dist/ avec tsup/tsc et exports modernes.", "evidence": ["shared/tsconfig.json: outDir './constants', rootDir './constants'"], "recommendation": "Utiliser outDir './dist', conserver sources dans './src' et fournir types via declaration." }
  ],
  "commands_to_reproduce": [
    "Get-ChildItem .\\shared -Recurse -File | Select-Object FullName,Length",
    "Get-Content .\\shared\\constants\\tag-categories.ts",
    "Select-String -Path .\\ -Pattern '@shared/' -List"
  ],
  "next_steps": [
    "Créer un package @ufm/shared avec build TS (dist + types).",
    "Activer npm/pnpm workspaces et référencer @ufm/shared côté frontend et backend.",
    "Supprimer la dépendance locale 'file:..' du backend et importer depuis @ufm/shared si nécessaire."
  ],
  "node_engine_recommendation": "Aligné sur repo: Node 20.x",
  "workspace_proposal": {
    "package_json_example": {
      "name": "@ufm/shared",
      "version": "0.1.0",
      "private": false,
      "type": "module",
      "main": "dist/index.js",
      "types": "dist/index.d.ts",
      "files": ["dist"],
      "scripts": {
        "build": "tsc -p tsconfig.build.json",
        "clean": "rimraf dist"
      },
      "devDependencies": {
        "typescript": "^5.2.2",
        "rimraf": "^5.0.5"
      }
    },
    "tsconfig_build_example": {
      "extends": "./tsconfig.json",
      "compilerOptions": {
        "rootDir": "src",
        "outDir": "dist",
        "declaration": true,
        "emitDeclarationOnly": false,
        "module": "ES2022",
        "target": "ES2022",
        "moduleResolution": "node"
      },
      "include": ["src/**/*"]
    },
    "folder_structure": [
      "shared/",
      "shared/package.json",
      "shared/tsconfig.json (base)",
      "shared/tsconfig.build.json",
      "shared/src/constants/tag-categories.ts",
      "shared/dist/* (build)"
    ],
    "workspace_root_changes_npm": {
      "package.json": {
        "private": true,
        "workspaces": ["backend", "frontend", "shared"]
      }
    },
    "migration_commands_pnpm": [
      "pnpm init -y (à la racine si besoin)",
      "Ajouter workspaces dans package.json root",
      "cd shared && pnpm init -y && pnpm add -D typescript rimraf && pnpm run build",
      "pnpm -F frontend add @ufm/shared@workspace:*",
      "pnpm -F backend add @ufm/shared@workspace:*"
    ],
    "migration_commands_npm": [
      "npm init -y (root si besoin)",
      "Éditer package.json root: \"workspaces\": [\"backend\", \"frontend\", \"shared\"]",
      "cd shared && npm init -y && npm i -D typescript rimraf && npm run build",
      "npm i -w frontend @ufm/shared@workspace:*",
      "npm i -w backend @ufm/shared@workspace:*"
    ]
  }
}