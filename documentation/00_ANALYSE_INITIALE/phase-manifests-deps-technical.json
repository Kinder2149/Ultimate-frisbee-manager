{
  "phase": "manifests-deps",
  "timestamp": "2025-11-05T13:15:00Z",
  "inputs_provided": [
    "tmp_backend_deps.json (npm ls --depth=0)",
    "tmp_frontend_deps.json (npm ls --depth=0)",
    "backend/package.json (-Raw)",
    "frontend/package.json (-Raw)"
  ],
  "summary": "Toolchain Node 20.x (backend engines) recommandée repo-wide; Angular ~17.3.x, TypeScript racine ^5.9.2 vs frontend ~5.2.2 à aligner; dépendance locale file:.. dans backend à corriger.",
  "details": [
    { "path": "backend/package.json", "type": "file", "role": "manifest", "size_bytes": 1631, "notes": "engines.node=20.x; scripts prisma/jest; deps clés: express 4.21.2, helmet 7.2.0, jsonwebtoken 9.0.2, multer 2.0.2, @prisma/client 5.22.0, prisma 5.22.0, pg 8.16.3, uuid 11.1.0, zod 4.1.9, supabase 2.40.7; dépendance locale 'ultimate-frisbee-manager: file:..'" },
    { "path": "frontend/package.json", "type": "file", "role": "manifest", "size_bytes": 1602, "notes": "Angular 17.3.x; TypeScript ~5.2.2; @angular-devkit/build-angular 17.3.17; Cypress 14.5.4; eslint 8.57.1; pas de engines déclarés." },
    { "path": "tmp_backend_deps.json", "type": "file", "role": "report", "size_bytes": 0, "notes": "npm ls backend: versions résolues confirment prisma 5.22.0, express 4.21.2, pg 8.16.3, helmet 7.2.0, multer 2.0.2, uuid 11.1.0, zod 4.1.9." },
    { "path": "tmp_frontend_deps.json", "type": "file", "role": "report", "size_bytes": 0, "notes": "npm ls frontend: Angular ~17.3.12/17.3.17 CLI/devkit; rxjs 7.8.2; zone.js 0.14.10; typescript 5.2.2; @angular/material 17.3.10." },
    { "path": "-", "type": "doc", "role": "analysis", "size_bytes": 0, "notes": "node_engine_recommendation=20.x (LTS) pour aligner backend et Angular 17; ts_version_current(root)=^5.9.2, ts_version_frontend=~5.2.2; angular_version=~17.3.x; dependencies_risks=[{dep:'ultimate-frisbee-manager(file:..)', action:'remove/replace'},{dep:'pg vs prisma sqlite', action:'review'},{dep:'eslint 8.57.1 avec TS 5.2/7.11 plugins', action:'monitor'},{dep:'Cypress 14.5.4', action:'monitor (poids CI)'}]" }
  ],
  "findings": [
    {
      "id": "ISSUE-101",
      "title": "Versions TypeScript divergentes (racine ^5.9.2 vs frontend ~5.2.2)",
      "severity": "medium",
      "description": "Risque d'outillage incohérent entre scripts racine et build frontend Angular 17 (recommandé TS ~5.2).",
      "evidence": [
        "root package.json: devDependencies.typescript = ^5.9.2",
        "frontend/package.json: devDependencies.typescript = ~5.2.2"
      ],
      "recommendation": "Aligner sur ~5.2.x pour Angular 17 ou isoler le TS racine (retirer TS au root si inutile)."
    },
    {
      "id": "ISSUE-102",
      "title": "Dépendance locale 'file:..' dans backend",
      "severity": "high",
      "description": "'ultimate-frisbee-manager': 'file:..' peut casser les builds CI/CD et les lockfiles reproductibles.",
      "evidence": [
        "backend/package.json: \"ultimate-frisbee-manager\": \"file:..\""
      ],
      "recommendation": "Supprimer ou remplacer par un package publié/version taguée; vérifier qu'aucun import n'en dépend."
    },
    {
      "id": "ISSUE-103",
      "title": "Incohérence SGBD: Prisma configure sqlite mais 'pg' est présent",
      "severity": "low",
      "description": "Confusion possible entre SQLite (dev) et Postgres (prod) sans documentation explicite.",
      "evidence": [
        "backend/prisma/schema.prisma: provider=sqlite",
        "backend/package.json: dependency pg ^8.x"
      ],
      "recommendation": "Documenter l'usage env(DATABASE_URL) et retirer 'pg' si non utilisé; sinon préparer migrations et URL Postgres."
    },
    {
      "id": "ISSUE-104",
      "title": "Absence d'engine Node côté frontend",
      "severity": "low",
      "description": "Le frontend ne fixe pas la version de Node; backend force 20.x.",
      "evidence": [
        "frontend/package.json: pas de champ engines",
        "backend/package.json: engines.node=20.x"
      ],
      "recommendation": "Déclarer engines.node=\">=20 <21\" dans frontend ou documenter la version Node repo-wide."
    }
  ],
  "commands_to_reproduce": [
    "npm --prefix backend ls --depth=0 --json | ConvertFrom-Json | ConvertTo-Json -Depth 5",
    "npm --prefix frontend ls --depth=0 --json | ConvertFrom-Json | ConvertTo-Json -Depth 5",
    "Get-Content .\\backend\\package.json -Raw | ConvertFrom-Json | Select-Object name,version,engines,scripts | Format-List",
    "Get-Content .\\frontend\\package.json -Raw | ConvertFrom-Json | Select-Object name,version,engines,scripts | Format-List",
    "npm --prefix frontend outdated",
    "npm --prefix backend outdated",
    "npm --prefix frontend audit --production --audit-level=moderate",
    "npm --prefix backend audit --production --audit-level=moderate"
  ],
  "next_steps": [
    "Uniformiser Node sur 20.x (LTS) dans toute la repo (frontend engines ou doc).",
    "Aligner TypeScript (viser ~5.2.x pour Angular 17) ou supprimer TS du root si non nécessaire.",
    "Retirer/remplacer la dépendance locale 'file:..' du backend.",
    "Clarifier SGBD cible et nettoyer deps (pg) si non utilisées; sinon préparer la config Postgres/documentation."
  ]
}