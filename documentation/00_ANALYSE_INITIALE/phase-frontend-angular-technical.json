{
  "phase": "frontend-angular",
  "timestamp": "2025-11-05T13:30:00Z",
  "inputs_provided": [
    "frontend/angular.json (raw)",
    "frontend/tsconfig.json (raw)",
    "frontend/src/main.ts (head)",
    "grep routes in frontend/src (RouterModule.forRoot/forChild, path, loadChildren)",
    "frontend/src/environments/environment.ts",
    "frontend/src/environments/environment.prod.ts",
    "app/app.module.ts (routes)"
  ],
  "summary": "Angular 17 app bootstrappée via AppModule. Routes lazy pour features (auth, settings, exercices, entrainements, echauffements, situations-matchs, tags-advanced). Envs exposent apiUrl et des clés Supabase (SEC-LEAK). @shared utilisé via tsconfig paths.",
  "details": [
    { "path": "frontend/src/main.ts", "type": "file", "role": "entrypoint", "size_bytes": 212, "notes": "platformBrowserDynamic().bootstrapModule(AppModule)." },
    { "path": "frontend/angular.json", "type": "file", "role": "config", "size_bytes": 3260, "notes": "main=src/main.ts; fileReplacements env.prod.ts en production; proxy.conf.json pour dev server." },
    { "path": "frontend/tsconfig.json", "type": "file", "role": "config", "size_bytes": 0, "notes": "paths: '@shared/*' -> '../../shared/*'." },

    { "path": "app/app.module.ts", "type": "file", "role": "routes_root", "size_bytes": 0, "notes": "RouterModule.forRoot([...])." },
    { "path": "route /forgot-password", "type": "route", "role": "public", "size_bytes": 0, "notes": "loadComponent standalone ForgotPasswordPageComponent (lazy)." },
    { "path": "route /login", "type": "route", "role": "public", "size_bytes": 0, "notes": "loadChildren ./features/auth/auth.module (lazy)." },
    { "path": "route / (dashboard)", "type": "route", "role": "protected", "size_bytes": 0, "notes": "component=DashboardComponent, canActivate=[AuthGuard]." },
    { "path": "route /tags -> redirect /parametres/tags", "type": "route", "role": "protected", "size_bytes": 0, "notes": "redirectTo pathMatch full." },
    { "path": "route /tags-advanced", "type": "route", "role": "protected", "size_bytes": 0, "notes": "loadChildren ./features/tags-advanced/tags-advanced.module (lazy), canActivate=[AuthGuard]." },
    { "path": "route /parametres", "type": "route", "role": "protected", "size_bytes": 0, "notes": "loadChildren ./features/settings/settings.module (lazy), canActivate=[AuthGuard]." },
    { "path": "route /exercices (x2)", "type": "route", "role": "protected", "size_bytes": 0, "notes": "loadChildren ./features/exercices/exercices.module (lazy), canActivate=[AuthGuard], data.preload=true (une entrée dupliquée)." },
    { "path": "route /entrainements", "type": "route", "role": "protected", "size_bytes": 0, "notes": "loadChildren ./features/entrainements/entrainements.module (lazy), canActivate=[AuthGuard]." },
    { "path": "route /echauffements", "type": "route", "role": "protected", "size_bytes": 0, "notes": "loadChildren ./features/echauffements/echauffements.module (lazy), canActivate=[AuthGuard]." },
    { "path": "route /situations-matchs", "type": "route", "role": "protected", "size_bytes": 0, "notes": "loadChildren ./features/situations-matchs/situations-matchs.module (lazy), canActivate=[AuthGuard]." },
    { "path": "route ** -> /login", "type": "route", "role": "fallback", "size_bytes": 0, "notes": "catch-all redirect to login." },

    { "path": "features/exercices/exercices.module.ts", "type": "file", "role": "routes_child", "size_bytes": 0, "notes": "forChild: '', 'ajouter', 'modifier/:id', 'voir/:id', '**'." },
    { "path": "features/entrainements/entrainements.module.ts", "type": "file", "role": "routes_child", "size_bytes": 0, "notes": "forChild: '', 'nouveau', 'modifier/:id', ..." },
    { "path": "features/echauffements/echauffements.module.ts", "type": "file", "role": "routes_child", "size_bytes": 0, "notes": "forChild similaire (list/form)." },
    { "path": "features/situations-matchs/situations-matchs.module.ts", "type": "file", "role": "routes_child", "size_bytes": 0, "notes": "forChild: '', 'ajouter', 'modifier/:id', ':id'." },
    { "path": "features/settings/settings.module.ts", "type": "file", "role": "routes_child", "size_bytes": 0, "notes": "forChild children: tags, import-exercices, profil, admin(guard Role), admin/explorer(guard Role)." },

    { "path": "frontend/src/environments/environment.ts", "type": "file", "role": "env_dev", "size_bytes": 0, "notes": "apiUrl=http://localhost:3002/api; supabaseUrl=<REDACTED>; supabaseKey=<REDACTED> (SEC-LEAK)." },
    { "path": "frontend/src/environments/environment.prod.ts", "type": "file", "role": "env_prod", "size_bytes": 0, "notes": "apiUrl=https://ultimate-frisbee-manager-api.onrender.com/api; supabaseUrl=<REDACTED>; supabaseKey=<REDACTED> (SEC-LEAK)." },

    { "path": "@shared usage", "type": "doc", "role": "shared_imports", "size_bytes": 0, "notes": "Fichiers consommateurs: tags-manager.component.ts, tag-form.component.ts, tag-mapping.component.ts, settings/tag-list.component.ts, core/models/tag.model.ts (imports @shared/constants/tag-categories)." }
  ],
  "findings": [
    {
      "id": "SEC-LEAK-SUPABASE-ENV-DEV",
      "title": "Clés Supabase exposées dans environment.ts",
      "severity": "high",
      "description": "Le fichier d'environnement de développement inclut supabaseUrl et supabaseKey en clair.",
      "evidence": [
        "frontend/src/environments/environment.ts: supabaseUrl='<REDACTED>'",
        "frontend/src/environments/environment.ts: supabaseKey='<REDACTED>'"
      ],
      "recommendation": "Ne pas committer de clés dans le repo. Utiliser des variables d'environnement et un mécanisme d'injection au build. Remplacer par placeholders et charger via configuration sécurisée. Marqué SEC-LEAK-0001."
    },
    {
      "id": "SEC-LEAK-SUPABASE-ENV-PROD",
      "title": "Clés Supabase exposées dans environment.prod.ts",
      "severity": "high",
      "description": "Le fichier d'environnement de production inclut supabaseUrl et supabaseKey en clair.",
      "evidence": [
        "frontend/src/environments/environment.prod.ts: supabaseUrl='<REDACTED>'",
        "frontend/src/environments/environment.prod.ts: supabaseKey='<REDACTED>'"
      ],
      "recommendation": "Supprimer les secrets du code source. Utiliser des variables d'environnement de build (CI/CD) et ne livrer que les valeurs requises côté client en connaissance de cause (clé publique anonyme Supabase). Marqué SEC-LEAK-0002."
    },
    {
      "id": "ROUTE-DUP-EXERCICES",
      "title": "Route /exercices définie deux fois dans app.module.ts",
      "severity": "low",
      "description": "Deux entrées /exercices peuvent générer de la confusion; conserver une seule entrée avec data.preload si nécessaire.",
      "evidence": [
        "app.module.ts: deux occurrences path: 'exercices'"
      ],
      "recommendation": "Supprimer la duplication et centraliser les metadata (preload)."
    }
  ],
  "commands_to_reproduce": [
    "Get-Content .\\frontend\\src\\main.ts -TotalCount 50",
    "Select-String -Path .\\frontend\\src\\app\\app.module.ts -Pattern 'path:\s*\'|loadChildren|loadComponent|RouterModule.forRoot'",
    "Select-String -Path .\\frontend\\src\\**\\*.module.ts -Pattern 'RouterModule.forChild|path:\s*' -CaseSensitive:$false",
    "Get-Content .\\frontend\\src\\environments\\environment.ts",
    "Get-Content .\\frontend\\src\\environments\\environment.prod.ts",
    "Select-String -Path .\\frontend\\tsconfig.json -Pattern '@shared'",
    "Select-String -Path .\\frontend\\src\\**\\* -Pattern '@shared/' -CaseSensitive:$false"
  ],
  "next_steps": [
    "Retirer/masquer les clés Supabase du repo (placer placeholders) et documenter l'injection au build.",
    "Supprimer la duplication de route /exercices et vérifier le préchargement.",
    "Confirmer toutes les routes enfants (ajouter guards/roles si nécessaire) et l'usage d'AuthGuard.",
    "Vérifier la cohérence des URLs API entre environnements et l'usage du proxy en dev."
  ]
}