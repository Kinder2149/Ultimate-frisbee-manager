{
  "phase": "inventory",
  "timestamp": "2025-11-05T13:10:00Z",
  "inputs_provided": [
    "Get-Content ./package.json (top 80)",
    "Get-Content ./backend/package.json (top 120)",
    "Get-Content ./frontend/package.json (top 120)",
    "Get-Content ./frontend/angular.json (top 300)",
    "Get-Content ./backend/prisma/schema.prisma (top 500)",
    "Get-Content ./vercel.json",
    "Get-Content ./render.yaml",
    "FileInfo(frontend/src/main.ts)",
    "FileInfo(backend/server.js)",
    "FileInfo(backend/app.js)"
  ],
  "summary": "Inventaire monorepo Node/Angular: manifests clés collectés, entrypoints front (frontend/src/main.ts) et back (backend/server.js) identifiés.",
  "details": [
    { "path": "package.json", "type": "file", "role": "manifest", "size_bytes": 369, "notes": "Monorepo minimal, script start pour frontend; pas de workspaces." },
    { "path": "backend/package.json", "type": "file", "role": "manifest", "size_bytes": 1631, "notes": "Node engines 20.x, scripts Prisma et Jest." },
    { "path": "frontend/package.json", "type": "file", "role": "manifest", "size_bytes": 1602, "notes": "Angular 17, eslint config, TypeScript ~5.2.2." },
    { "path": "frontend/angular.json", "type": "file", "role": "config", "size_bytes": 3260, "notes": "main=src/main.ts, outputPath=dist/ultimate-frisbee-manager." },
    { "path": "backend/prisma/schema.prisma", "type": "file", "role": "manifest", "size_bytes": 6369, "notes": "datasource sqlite via env(DATABASE_URL); plusieurs modèles (Exercice, Tag, Entrainement...)." },
    { "path": "vercel.json", "type": "file", "role": "config", "size_bytes": 200, "notes": "Build frontend via @vercel/angular; routes SPA." },
    { "path": "render.yaml", "type": "file", "role": "config", "size_bytes": 797, "notes": "Présent (contenu non affiché dans la commande initiale à cause d'une erreur -ErrorAction)." },
    { "path": "frontend/src/main.ts", "type": "file", "role": "entrypoint", "size_bytes": 212, "notes": "Entrée Angular confirmée par angular.json." },
    { "path": "backend/server.js", "type": "file", "role": "entrypoint", "size_bytes": 1160, "notes": "point d’entrée backend (main) d’après backend/package.json." },
    { "path": "backend/app.js", "type": "file", "role": "code", "size_bytes": 483, "notes": "Chargé par server.js (probable configuration Express)." }
  ],
  "findings": [
    {
      "id": "ISSUE-001",
      "title": "Dépendance locale file:.. dans backend (risque de packaging CI/CD)",
      "severity": "medium",
      "description": "backend/package.json déclare 'ultimate-frisbee-manager': 'file:..', dépendance locale au répertoire parent pouvant casser les builds distants.",
      "evidence": [
        "backend/package.json: \"ultimate-frisbee-manager\": \"file:..\""
      ],
      "recommendation": "Remplacer/retirer la dépendance locale ou publier/utiliser une version distante; vérifier que rien ne dépend réellement de ce package."
    },
    {
      "id": "ISSUE-002",
      "title": "Écart de SGBD: Prisma configure sqlite tandis que 'pg' est présent",
      "severity": "low",
      "description": "Le datasource Prisma est 'sqlite' mais 'pg' existe en dependencies. Incohérence potentielle ou héritage historique.",
      "evidence": [
        "backend/prisma/schema.prisma: provider = \"sqlite\"",
        "backend/package.json: \"pg\": \"^8.11.3\""
      ],
      "recommendation": "Confirmer le SGBD cible. Si sqlite en dev et Postgres en prod, documenter et gérer DATABASE_URL correctement; sinon retirer la dépendance inutile."
    },
    {
      "id": "ISSUE-003",
      "title": "Mélange de versions TypeScript (racine vs frontend)",
      "severity": "low",
      "description": "La racine utilise typescript ^5.9.2 (devDependencies), le frontend verrouille ~5.2.2, pouvant créer des divergences d’outillage.",
      "evidence": [
        "package.json (root): 'typescript': '^5.9.2'",
        "frontend/package.json: 'typescript': '~5.2.2'"
      ],
      "recommendation": "Aligner les versions TypeScript ou isoler strictement les environnements; au minimum documenter la version Node/TS attendue par package." 
    },
    {
      "id": "ISSUE-004",
      "title": "Absence de workspaces monorepo (optionnel)",
      "severity": "low",
      "description": "Le monorepo ne définit pas de workspaces npm/yarn/pnpm; gestion des dépendances séparée, scripts transverses limités.",
      "evidence": [
        "package.json (root): scripts minimalistes, pas de 'workspaces'"
      ],
      "recommendation": "Envisager des workspaces pour simplifier les installs/CI; sinon, garder le modèle actuel mais documenter la procédure."
    }
  ],
  "commands_to_reproduce": [
    "Get-Content .\\backend\\package.json -TotalCount 200 | Select-String -Pattern 'file:\\..'",
    "Get-Content .\\backend\\prisma\\schema.prisma -TotalCount 200 | Select-String -Pattern 'provider = \"sqlite\"'",
    "Get-Content .\\backend\\package.json -TotalCount 200 | Select-String -Pattern 'pg'",
    "Get-Content .\\package.json -TotalCount 120 | Select-String -Pattern 'typescript'",
    "Get-Content .\\frontend\\package.json -TotalCount 120 | Select-String -Pattern 'typescript'",
    "Test-Path .\\frontend\\src\\main.ts; Test-Path .\\backend\\server.js; Test-Path .\\backend\\app.js",
    "Get-Content .\\frontend\\angular.json -TotalCount 60 | Select-String -Pattern 'main": "src/main.ts'",
    "Get-Content .\\vercel.json -ErrorAction SilentlyContinue",
    "Get-Content .\\render.yaml -ErrorAction SilentlyContinue"
  ],
  "next_steps": [
    "Valider le SGBD cible et la stratégie DATABASE_URL (sqlite vs Postgres).",
    "Vérifier l’utilité réelle de la dépendance locale 'file:..' dans le backend et la supprimer si inutile.",
    "Décider d’un alignement TypeScript (racine vs frontend) et le documenter.",
    "Lister les entrypoints secondaires (scripts npm, seed, tests) et vérifier la CI/CD (render/vercel)."
  ]
}