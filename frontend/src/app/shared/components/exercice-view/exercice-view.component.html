<div class="view-container">
  <!-- üè∑Ô∏è Header -->
  <div class="dialog-header sticky" *ngIf="dialogRef">
    <h2 class="title">
      <mat-icon class="title-icon">sports_handball</mat-icon>
      {{ exercice.nom || 'Exercice' }}
    </h2>
    <button mat-icon-button aria-label="Fermer" (click)="close()"><mat-icon>close</mat-icon></button>
  </div>
  <mat-divider *ngIf="dialogRef"></mat-divider>

  <div class="dialog-content">
    <!-- Header info (objectif + travail sp√©cifique) -->
    <header class="ex-header">
      <div class="ex-header-main">
        <h1 class="ex-title">{{ exercice.nom || 'Exercice' }}</h1>
        <div class="ex-tags-row">
          <div class="ex-tag-group" *ngIf="objectifTag">
            <span class="group-label">Objectif</span>
            <span class="chip" [style.background-color]="objectifTag.color">{{ objectifTag.label }}</span>
          </div>
          <div class="ex-tag-group" *ngIf="travailSpecifiqueTags.length > 0">
            <span class="group-label">Travail sp√©cifique</span>
            <span class="chip" *ngFor="let tag of travailSpecifiqueTags" [style.background-color]="tag.color">{{ tag.label }}</span>
          </div>
        </div>
      </div>
    </header>

    <!-- üñºÔ∏è Section 1 : Image principale (si pr√©sente) -->
    <section class="section" *ngIf="mainImageUrl as img">
      <h3 class="section-title hl-sand">Image de l'exercice</h3>
      <div class="schema-gallery">
        <div class="schema-item" (click)="openImageViewer(img)">
          <img [src]="mediaUrl(img)" alt="Image de l'exercice">
        </div>
      </div>
    </section>

    <!-- üñºÔ∏è Section 2 : Galerie multi-sch√©mas -->
    <section class="section">
      <h3 class="section-title hl-sand">Sch√©mas de l'exercice</h3>
      <div class="schema-gallery" *ngIf="schemaUrlsList.length > 0; else noSchema">
        <div class="schema-item" *ngFor="let url of schemaUrlsList" (click)="openImageViewer(url)">
          <img [src]="mediaUrl(url)" alt="Sch√©ma de l'exercice">
        </div>
      </div>
      <ng-template #noSchema>
        <p class="view-text muted">Aucun sch√©ma n'a encore √©t√© ajout√©.</p>
      </ng-template>
    </section>

    <!-- üìñ Section 2 : Description -->
    <section class="section">
      <h3 class="section-title hl-purple">Description</h3>
      <app-rich-text-view [html]="exercice.description || 'Aucune description.'"></app-rich-text-view>
    </section>

    <!-- üéØ Section 3 : Points importants -->
    <section class="section" *ngIf="pointsList.length > 0">
      <h3 class="section-title hl-green">Points importants</h3>
      <ul class="points-list">
        <li *ngFor="let p of pointsList">
          <span class="point-icon">‚úî</span>
          <span class="point-text">{{ p }}</span>
        </li>
      </ul>
    </section>

    <!-- ü•á Section 4 : Crit√®re de r√©ussite -->
    <section class="section">
      <h3 class="section-title hl-blue">Crit√®re de r√©ussite</h3>
      <p class="view-text highlight">{{ exercice.critereReussite || '‚Äî' }}</p>
    </section>

    <!-- üìù Section 5 : Notes -->
    <section class="section">
      <h3 class="section-title with-pin">Notes</h3>
      <p class="view-text notes-box">{{ exercice.notes || consignes || 'Aucune note.' }}</p>
    </section>

    <!-- üß© Section 6 : Informations compl√©mentaires -->
    <section class="section">
      <h3 class="section-title hl-sand">Informations compl√©mentaires</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Mat√©riel</span>
          <span class="info-value">{{ exercice.materiel || 'Aucun mat√©riel sp√©cifique.' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Niveau</span>
          <span class="info-value">
            <ng-container *ngIf="niveauTags.length > 0; else noNiveau">
              <span class="chip" *ngFor="let tag of niveauTags" [style.background-color]="tag.color">{{ tag.label }}</span>
            </ng-container>
            <ng-template #noNiveau><span class="muted">‚Äî</span></ng-template>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Temps</span>
          <span class="info-value">
            <ng-container *ngIf="tempsTags.length > 0; else noTemps">
              <span class="chip" *ngFor="let tag of tempsTags" [style.background-color]="tag.color">{{ tag.label }}</span>
            </ng-container>
            <ng-template #noTemps><span class="muted">{{ duree || 'Non d√©fini' }}</span></ng-template>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Format</span>
          <span class="info-value">
            <ng-container *ngIf="formatTags.length > 0; else noFormat">
              <span class="chip" *ngFor="let tag of formatTags" [style.background-color]="tag.color">{{ tag.label }}</span>
            </ng-container>
            <ng-template #noFormat><span class="muted">‚Äî</span></ng-template>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Variables (+)</span>
          <span class="info-value">
            <ng-container *ngIf="variablesPlusList.length > 0; else noVarPlus">
              <ul class="dot-list">
                <li *ngFor="let v of variablesPlusList">{{ v }}</li>
              </ul>
            </ng-container>
            <ng-template #noVarPlus><span class="muted">‚Äî</span></ng-template>
          </span>
        </div>
        <div class="info-item">
          <span class="info-label">Variables (-)</span>
          <span class="info-value">
            <ng-container *ngIf="variablesMinusList.length > 0; else noVarMinus">
              <ul class="dot-list">
                <li *ngFor="let v of variablesMinusList">{{ v }}</li>
              </ul>
            </ng-container>
            <ng-template #noVarMinus><span class="muted">‚Äî</span></ng-template>
          </span>
        </div>
      </div>
    </section>
  </div>

  <div class="dialog-actions" *ngIf="dialogRef">
    <button mat-stroked-button (click)="close()">Fermer</button>
  </div>
</div>


