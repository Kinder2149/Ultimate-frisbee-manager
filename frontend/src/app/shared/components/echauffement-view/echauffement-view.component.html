<div class="view-container" [class.summary-mode]="isSummary">

  <!-- AFFICAHGE EN MODE RÉSUMÉ -->
  <div *ngIf="isSummary; else detailedView" class="summary-content">
    <div *ngIf="echauffement.description" class="summary-description">
      <app-rich-text-view [html]="echauffement.description"></app-rich-text-view>
    </div>
    <div class="summary-tags" *ngIf="echauffement.tags?.length">
      <mat-chip-listbox>
        <mat-chip *ngFor="let tag of echauffement.tags" [style.background-color]="tag.color || '#e0e0e0'" [style.color]="tag.color ? '#fff' : '#333'">
          {{ tag.label }}
        </mat-chip>
      </mat-chip-listbox>
    </div>
  </div>

  <!-- AFFICHAGE EN MODE DÉTAILLÉ -->
  <ng-template #detailedView>
    <div class="dialog-container">
      <!-- En-tête (uniquement en mode dialogue) -->
      <div class="dialog-header sticky" *ngIf="dialogRef">
        <h2 class="title">
          <mat-icon class="title-icon">fitness_center</mat-icon>
          {{ echauffement.nom || 'Échauffement' }}
        </h2>
        <button mat-icon-button aria-label="Fermer" (click)="close()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <mat-divider *ngIf="dialogRef"></mat-divider>

      <div class="dialog-content">
        <!-- Contenu détaillé ici -->
        <div class="section image-section" *ngIf="echauffement.imageUrl as url" (click)="openImageViewer(url)" title="Agrandir l'image">
          <img [src]="mediaUrl(url)" alt="Illustration de l'échauffement" class="preview-image" />
        </div>
        <div class="section" *ngIf="echauffement.description as description">
          <h3>Description</h3>
          <app-rich-text-view [html]="description"></app-rich-text-view>
        </div>
        <div class="section" *ngIf="echauffement.blocs?.length">
          <h3>Blocs</h3>
          <div class="blocs">
            <div class="bloc" *ngFor="let bloc of echauffement.blocs; let i = index">
              <div class="bloc-header">
                <span class="bloc-index">{{ i + 1 }}</span>
                <span class="bloc-title">{{ bloc.titre || 'Bloc' }}</span>
              </div>
              <div class="bloc-body">
                <mat-chip-set class="bloc-chips">
                  <mat-chip *ngIf="bloc.repetitions"><mat-icon>repeat</mat-icon>{{ bloc.repetitions }}</mat-chip>
                  <mat-chip *ngIf="bloc.temps"><mat-icon>schedule</mat-icon>{{ bloc.temps }}</mat-chip>
                </mat-chip-set>
                <div class="bloc-details" *ngIf="bloc.informations">
                  <p>{{ bloc.informations }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pied de page (uniquement en mode dialogue) -->
      <div class="dialog-actions" *ngIf="dialogRef">
        <button mat-stroked-button (click)="close()">Fermer</button>
      </div>
    </div>
  </ng-template>
</div>
