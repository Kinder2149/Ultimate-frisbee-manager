<div class="search-filter-card">
  <h3>Filtres de recherche</h3>

  <!-- Barre de recherche et actions -->
  <div class="search-actions-bar">
    <mat-form-field appearance="outline" class="search-input-container">
      <mat-label>{{ searchPlaceholder }}</mat-label>
      <input matInput type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()">
      <mat-icon matPrefix>search</mat-icon>
      <button *ngIf="searchTerm" mat-icon-button matSuffix (click)="searchTerm = ''; onSearchChange()" title="Effacer la recherche">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <button mat-stroked-button (click)="resetAll()">RÃ©initialiser les filtres</button>
  </div>

  <!-- Zone de filtres -->
  <div class="filters-area">


    <div class="filters-list">
      <div *ngFor="let filter of filterOptions" [ngSwitch]="filter.type" class="filter-item">
        
        <!-- Input texte -->
        <mat-form-field appearance="outline" *ngSwitchCase="'text'">
          <mat-label>{{ filter.label }}</mat-label>
          <input matInput type="text" [value]="filter.value || ''" (input)="onFilterChange(filter.key, getInputValue($event))">
        </mat-form-field>

        <!-- Select -->
        <mat-form-field appearance="outline" *ngSwitchCase="'select'">
          <mat-label>{{ filter.label }}</mat-label>
          <mat-select [value]="filter.value" (selectionChange)="onFilterChange(filter.key, $event.value)" panelClass="colored-dropdown-panel">
            <mat-option value="">Tous</mat-option>
            <mat-option *ngFor="let opt of filter.options" [value]="opt.value">
              <span class="color-swatch" [style.background-color]="opt.color" *ngIf="opt.color"></span>
              {{ opt.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Checkbox -->
        <mat-checkbox *ngSwitchCase="'boolean'" [checked]="filter.value === true" (change)="onFilterChange(filter.key, $event.checked)">
          {{ filter.label }}
        </mat-checkbox>

        <!-- Date -->
        <mat-form-field appearance="outline" *ngSwitchCase="'date'">
          <mat-label>{{ filter.label }}</mat-label>
          <input matInput [matDatepicker]="picker" [value]="filter.value" (dateChange)="onFilterChange(filter.key, $event.value)">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <!-- Range -->
        <!-- Labels au-dessus pour les ranges -->
        <div *ngSwitchCase="'range'" class="filter-item-stacked">
          <label>{{ filter.label }}</label>
          <div class="range-inputs">
          <mat-form-field appearance="outline">
            <mat-label>{{ filter.label }} (Min)</mat-label>
            <input matInput type="number" [value]="getRangeValue(filter.value, 'min')" (input)="updateRangeMin($event, filter.key)">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Max</mat-label>
            <input matInput type="number" [value]="getRangeValue(filter.value, 'max')" (input)="updateRangeMax($event, filter.key)">
            </mat-form-field>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
