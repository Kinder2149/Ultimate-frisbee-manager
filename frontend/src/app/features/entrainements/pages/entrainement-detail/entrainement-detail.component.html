<div class="container">
  <!-- En-tête -->
  <div class="header">
    <button class="btn btn-secondary" (click)="retourListe()">
      <i class="material-icons">arrow_back</i>
      Retour à la liste
    </button>
    <h1>Détail de l'entraînement</h1>
    <button 
      *ngIf="entrainement" 
      class="btn btn-primary" 
      (click)="modifierEntrainement()">
      <i class="material-icons">edit</i>
      Modifier
    </button>
  </div>

  <!-- Message de chargement -->
  <div *ngIf="loading" class="loading">
    <p>Chargement de l'entraînement...</p>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="error" class="error-message">
    {{ error }}
    <button class="btn btn-secondary" (click)="loadEntrainement(entrainementId!)">Réessayer</button>
  </div>

  <!-- Détails de l'entraînement -->
  <div *ngIf="!loading && !error && entrainement" class="entrainement-detail">
    
    <!-- Informations générales -->
    <div class="section">
      <h2>Informations générales</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Titre :</span>
          <span class="value">{{ entrainement.titre }}</span>
        </div>
        
        <div class="info-item" *ngIf="entrainement.date">
          <span class="label">Date :</span>
          <span class="value">{{ formatDate(entrainement.date) }}</span>
        </div>

        <div class="info-item" *ngIf="entrainement.imageUrl">
          <span class="label">Image :</span>
          <div class="value">
            <img [src]="mediaUrl(entrainement.imageUrl)" alt="Image de l'entraînement" class="thumbnail clickable" (click)="openImageViewer(entrainement.imageUrl, 'Image de l\'entraînement: ' + entrainement.titre)">
          </div>
        </div>
        
        <div class="info-item" *ngIf="entrainement.tags && entrainement.tags.length > 0">
          <span class="label">Thèmes :</span>
          <div class="tags-display">
            <span *ngFor="let tag of entrainement.tags" 
                  class="tag"
                  [style.background-color]="tag.color || '#e0e0e0'">
              {{ tag.label }}
            </span>
          </div>
        </div>
        
        <div class="info-item" *ngIf="entrainement.createdAt">
          <span class="label">Créé le :</span>
          <span class="value">{{ formatDate(entrainement.createdAt) }}</span>
        </div>
        
        <div class="info-item">
          <span class="label">Durée totale :</span>
          <span class="value total-duration">{{ calculateTotalDuration() }}</span>
        </div>
      </div>
    </div>

    <!-- Échauffement -->
    <div class="section echauffement-theme" id="echauffement" *ngIf="entrainement.echauffement">
      <div class="section-header" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <h2 style="margin:0;">Échauffement</h2>
        <div class="section-actions" style="display:flex; align-items:center; gap:8px;">
          <app-action-button
            icon="visibility"
            iconType="material"
            [buttonColor]="'#6b7280'"
            [iconColor]="'#fff'"
            tooltip="Afficher l'échauffement"
            (click)="openEchauffementView()">
          </app-action-button>
        </div>
      </div>
      <div class="card themed-card">
        <div class="themed-header">
          <h3>{{ entrainement.echauffement.nom }}</h3>
          <i class="material-icons">fitness_center</i>
        </div>
        <div class="themed-content" *ngIf="entrainement.echauffement.description">
          <p>{{ entrainement.echauffement.description }}</p>
        </div>
        <div class="blocs-list" *ngIf="entrainement.echauffement.blocs && entrainement.echauffement.blocs.length > 0">
          <h4>Blocs d'échauffement :</h4>
          <div *ngFor="let bloc of entrainement.echauffement.blocs; let i = index" class="bloc-item right-time">
            <!-- Rail temps à droite pour l'échauffement -->
            <div *ngIf="bloc.temps" class="right-rail-time echauffement" aria-label="Temps du bloc (droite)">
              <i class="material-icons">schedule</i>
              <span>{{ bloc.temps }}</span>
            </div>
            <span class="index-bubble">{{ i + 1 }}</span>
            <div class="bloc-content">
              <h5>{{ bloc.titre }}</h5>
              <div class="bloc-details">
                <span *ngIf="bloc.repetitions" class="detail">Répétitions: {{ bloc.repetitions }}</span>
              </div>
              <p *ngIf="bloc.informations" class="bloc-info">{{ bloc.informations }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Liste des exercices -->
    <div class="section exercice-theme">
      <h2>Exercices de l'entraînement</h2>
      
      <div *ngIf="!entrainement.exercices || entrainement.exercices.length === 0" class="no-exercices">
        <p>Aucun exercice associé à cet entraînement.</p>
      </div>

      <div *ngIf="entrainement.exercices && entrainement.exercices.length > 0" class="exercices-list">
        <ng-container *ngFor="let exerciceEntrainement of entrainement.exercices; let i = index">
          <!-- Barre d'action pour afficher l'exercice au format de la page Exercice -->
          <div class="exercice-actions" style="display:flex; justify-content:flex-end; margin-bottom:6px;">
            <app-action-button
              icon="visibility"
              iconType="material"
              [buttonColor]="'#6b7280'"
              [iconColor]="'#fff'"
              tooltip="Afficher l'exercice"
              (click)="openExerciceView(exerciceEntrainement.exercice)">
            </app-action-button>
          </div>
          <app-exercice-card
            *ngIf="exerciceEntrainement.exercice"
            [exercice]="exerciceEntrainement.exercice"
            [index]="i + 1"
            [duree]="exerciceEntrainement.duree"
            [notes]="exerciceEntrainement.notes"
            [mode]="'entrainement'"
            (imageClick)="openImageViewer($event, 'Image de l\'exercice: ' + exerciceEntrainement.exercice.nom)"
            [allowEditDuration]="true"
            (dureeChange)="onExerciceDureeChange(i, $event)">
          </app-exercice-card>
        </ng-container>
      </div>
    </div>

    <!-- Situation/Match -->
    <div class="section situation-theme" *ngIf="entrainement.situationMatch">
      <div class="section-header" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <h2 style="margin:0;">Situation/Match</h2>
        <div class="section-actions" style="display:flex; align-items:center; gap:8px;">
          <app-action-button
            icon="visibility"
            iconType="material"
            [buttonColor]="'#6b7280'"
            [iconColor]="'#fff'"
            tooltip="Afficher la situation/match"
            (click)="openSituationView()">
          </app-action-button>
        </div>
      </div>
      <div class="card themed-card right-time">
        <!-- Rail temps à droite pour la situation -->
        <div *ngIf="entrainement.situationMatch.temps" class="right-rail-time situation" aria-label="Temps situation (droite)">
          <i class="material-icons">schedule</i>
          <span>{{ entrainement.situationMatch.temps }}</span>
        </div>
        <div class="themed-header">
          <h3>{{ entrainement.situationMatch.nom || entrainement.situationMatch.type }}</h3>
          <span class="situation-type">{{ entrainement.situationMatch.type }}</span>
          <i class="material-icons">sports</i>
        </div>
        <div class="themed-content">
          <p *ngIf="entrainement.situationMatch.description">{{ entrainement.situationMatch.description }}</p>
          
          <div class="tags" *ngIf="entrainement.situationMatch.tags && entrainement.situationMatch.tags.length > 0">
            <h4>Tags :</h4>
            <div class="tag-list">
              <span *ngFor="let tag of entrainement.situationMatch.tags" 
                    class="tag"
                    [style.background-color]="tag.color || '#e0e0e0'">
                {{ tag.label }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
