<div class="dialog-container">
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>edit</mat-icon>
      Éditer l'utilisateur
    </h2>
    <button mat-icon-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <form [formGroup]="editForm" class="edit-form">
      <!-- Nom et Prénom -->
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Prénom</mat-label>
          <input matInput formControlName="prenom" placeholder="Prénom">
          <mat-icon matPrefix>person</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Nom</mat-label>
          <input matInput formControlName="nom" placeholder="Nom">
          <mat-icon matPrefix>person</mat-icon>
        </mat-form-field>
      </div>

      <!-- Email -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" type="email" placeholder="email@example.com">
        <mat-icon matPrefix>email</mat-icon>
        <mat-error *ngIf="editForm.get('email')?.invalid && editForm.get('email')?.touched">
          {{ getEmailError() }}
        </mat-error>
      </mat-form-field>

      <!-- Rôle -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Rôle</mat-label>
        <mat-select formControlName="role">
          <mat-option value="USER">
            <div class="role-option">
              <mat-icon>person</mat-icon>
              <span>Utilisateur</span>
            </div>
          </mat-option>
          <mat-option value="ADMIN">
            <div class="role-option">
              <mat-icon>admin_panel_settings</mat-icon>
              <span>Administrateur</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>shield</mat-icon>
      </mat-form-field>

      <!-- Avatar URL -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>URL de l'avatar (optionnel)</mat-label>
        <input matInput formControlName="iconUrl" type="url" placeholder="https://...">
        <mat-icon matPrefix>image</mat-icon>
        <mat-hint>Laisser vide pour utiliser les initiales</mat-hint>
      </mat-form-field>

      <!-- Statut actif -->
      <div class="toggle-field">
        <mat-slide-toggle formControlName="isActive" color="primary">
          <div class="toggle-label">
            <mat-icon>{{ editForm.get('isActive')?.value ? 'check_circle' : 'cancel' }}</mat-icon>
            <span>Compte {{ editForm.get('isActive')?.value ? 'actif' : 'inactif' }}</span>
          </div>
        </mat-slide-toggle>
      </div>

      <!-- Informations -->
      <div class="info-box">
        <mat-icon>info</mat-icon>
        <div class="info-content">
          <p><strong>Note :</strong> Les modifications seront appliquées immédiatement.</p>
          <p *ngIf="editForm.get('role')?.value === 'ADMIN'" class="warning">
            ⚠️ Ce compte aura des privilèges d'administration complets.
          </p>
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-button (click)="onCancel()" [disabled]="saving">
      Annuler
    </button>
    <button mat-raised-button color="primary" (click)="onSave()" [disabled]="saving || editForm.invalid">
      <mat-spinner *ngIf="saving" diameter="20"></mat-spinner>
      <mat-icon *ngIf="!saving">save</mat-icon>
      <span *ngIf="!saving">Enregistrer</span>
      <span *ngIf="saving">Enregistrement...</span>
    </button>
  </mat-dialog-actions>
</div>
