<app-auth-layout 
  title="Nouveau mot de passe" 
  subtitle="Définissez un mot de passe sécurisé"
  maxWidth="460px">
  
  <div *ngIf="!success; else successBlock">
    <form [formGroup]="form" (ngSubmit)="submit()" class="auth-form">
      <p class="info-text">
        Choisissez un nouveau mot de passe fort pour votre compte. Ce lien est valable pour une durée limitée.
      </p>
      
      <app-auth-error [message]="error" *ngIf="error"></app-auth-error>
      
      <app-auth-loader 
        *ngIf="loading" 
        message="Mise à jour du mot de passe..."
        [size]="40">
      </app-auth-loader>

      <div *ngIf="!loading">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nouveau mot de passe</mat-label>
          <input matInput formControlName="newPassword" [type]="hideNewPassword ? 'password' : 'text'" placeholder="Choisissez un mot de passe fort">
          <button mat-icon-button matSuffix type="button" (click)="hideNewPassword = !hideNewPassword">
            <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="form.get('newPassword')?.hasError('required')">Mot de passe requis</mat-error>
          <mat-error *ngIf="form.get('newPassword')?.hasError('minlength')">Au moins 8 caractères</mat-error>
        </mat-form-field>
        
        <app-password-strength 
          [password]="form.get('newPassword')?.value || ''"
          [showDetails]="true">
        </app-password-strength>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmer le mot de passe</mat-label>
          <input matInput formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'" placeholder="Retapez votre mot de passe">
          <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword">
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="form.hasError('passwordMismatch')">Les mots de passe ne correspondent pas</mat-error>
        </mat-form-field>

        <div class="form-actions" style="justify-content: space-between;">
          <a routerLink="/login" class="link-secondary">Annuler</a>
          <button mat-raised-button color="primary" type="submit" class="btn-primary" [disabled]="form.invalid">
            <mat-icon>lock_reset</mat-icon>
            <span>Mettre à jour</span>
          </button>
        </div>
      </div>
    </form>
  </div>

  <ng-template #successBlock>
    <div class="success-box">
      <mat-icon>check_circle</mat-icon>
      <h3>Mot de passe mis à jour !</h3>
      <p>Votre mot de passe a été mis à jour avec succès.</p>
      <p style="font-size: 13px; margin-top: 12px;">Vous pouvez maintenant vous connecter avec vos nouveaux identifiants.</p>
      <button mat-raised-button color="primary" class="btn-primary" routerLink="/login" style="margin-top: 20px;">
        <mat-icon>login</mat-icon>
        <span>Aller à la connexion</span>
      </button>
    </div>
  </ng-template>
  
</app-auth-layout>
